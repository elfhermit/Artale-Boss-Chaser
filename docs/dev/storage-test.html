<!doctype html>
<html><head><meta charset="utf-8"><title>Storage Test</title></head><body>
<h3>Per-boss Storage Quick Test</h3>
<div id="out"></div>
<script src="../js/storage.js"></script>
<script>
function log(msg){ const d=document.getElementById('out'); d.innerHTML += '<div>'+msg+'</div>'; }

// Clean test namespace
localStorage.removeItem('abt_records_v1');
// create a single-key legacy data for migration testing
const legacy = { records: [] };
for(let i=0;i<5;i++){ legacy.records.push({ id: 'legacy-'+i, bossId: 'bossA', timestamp: new Date().toISOString(), channel: i+1, looted: i%2===0, note: 'legacy'+i, createdAt: new Date().toISOString() }); }
localStorage.setItem('abt_records_v1', JSON.stringify(legacy));
log('legacy single-key created with 5 records');

// dry-run migration
const dry = PerBossStorage.migrationToolFromSingleKey('abt_records_v1', { dryRun:true });
log('dry-run migration summary: ' + JSON.stringify(dry));

// perform migration
const res = PerBossStorage.migrationToolFromSingleKey('abt_records_v1', { dryRun:false });
log('migration result: ' + JSON.stringify(res));

// read per-boss records
const bossA = PerBossStorage.getRecordsForBoss({ bossId: 'bossA' });
log('bossA records after migration count: ' + bossA.length);

// add some records
const added = PerBossStorage.addRecordForBoss('bossA', { timestamp: new Date().toISOString(), channel: 10, looted: true, note: 'new1' });
log('added record id: ' + added.id);

// export all
const exported = PerBossStorage.exportAllPerBoss();
log('exported keys: ' + Object.keys(JSON.parse(exported).recordsByBoss).join(','));

</script>
</body></html>